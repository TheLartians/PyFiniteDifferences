

\subsubsection{Two Dimensions} \label{sec:finite_difference_propagator_2D}

If the field is constant in $y$ direction, equation  \eqref{eq:paraxial_wave_equation} becomes

\begin{align*}
\frac{\partial u}{\partial z} = A\frac{\partial^2 u}{\partial x^2} + F  u.
\end{align*}

Since field values are given at discretized points, we approximate derivatives with their difference quotient

\begin{align*}
\left. \frac{\partial u}{\partial z}  \right\rvert_{\substack{x=x_i\\z=z_k}} \! &\rightarrow \frac{u_i^{k+1} - u_i^{k}}{\Delta z} &
\left. \frac{\partial^2 u}{\partial x^2}  \right\rvert_{\substack{x=x_i\\z=z_k}} \! &\rightarrow \frac{u_{i-1}^{k} - 2 u_{i}^{k} + u_{i+1}^{k}}{\Delta x^2},
\end{align*}

resulting in the forward Euler step

\begin{align*}
\frac{u_i^{k+1} - u_i^{k}}{\Delta z} =
A \frac{u_{i-1}^{k} - 2 u_{i}^{k} + u_{i+1}^{k}}{\Delta x^2} + F(x_i,0,z_k) u_{i}^{k}  := f^k_i .
\end{align*}

The Euler method is only first-order accurate and is numerically unstable at large step sizes. We therefore implement our propagator using the Crankâ€“Nicolson method, which is an implicit method that is second-order accurate in $\Delta x$ and $\Delta z$ and unconditionally stable~\cite{DissertationFuhse}

\begin{align*}
\frac{u_i^{k+1} - u_i^{k}}{\Delta z} := \frac{ f^k_i +  f^{k+1}_i }{2} .
\end{align*}

Reordering terms and introducing the auxiliary variables $r_A = A \frac{\Delta z}{ \Delta x^2}$ and $C_i^{k} = \frac{\Delta z}{2} F(x_i,0,z_{k})$ gives us

\begin{align} \label{eq:2D_finite_difference_equation}
\begin{split}
 & u_i^{k+1} ( 1 + 2 \, r_x - C_i^{k+1} ) - r_x ( u_{i-1}^{k+1} + u_{i+1}^{k+1} )\\
= \; &  u_i^{k \phantom{ + 1} } ( 1 - 2\,r_x + C_i^{k \phantom{ + 1} }) + r_x (u_{i-1}^{k \phantom{ + 1} } + u_{i+1}^{k \phantom{ + 1} }  ).
\end{split}
\end{align}

If the boundary conditions at the edges $u_0^k$ and $u_{n_x+1}^k$ are known for all $k$, equation \eqref{eq:2D_finite_difference_equation} can be rewritten as the matrix equation

\begin{align} \label{eq:FD1DMatrixEquation}
B^n \boldsymbol u^{k+1} = \boldsymbol d^k,
\end{align}

where $\left(\boldsymbol u^{k}\right)_i = u_{i}^{k}$, $B^n$ is the $n_x \times n_x$ tridiagonal matrix

\begin{align*}
B^n = \left(
\begin{matrix}
    ( 1 + 2 \, r_x - C_1^{k+1} ) & - r_x & 0 &   \\
    - r_x  & ( 1 + 2 \, r_x - C_2^{k+1} ) & - r_x  & \dots \\
    0 & - r_x  & ( 1 + 2 \, r_x - C_3^{k+1} ) &  \\
     & \vdots & & \ddots
\end{matrix}
\right),
\end{align*}

and $d^k$ is a vector containing the right side of equation \eqref{eq:2D_finite_difference_equation} and the edge boundary conditions

\begin{align*}
\boldsymbol d^k = \left(
\begin{matrix}
u_{1}^{k } ( 1 - 2\,r_x + C_1^{k}) + r_x (u_{0}^{k } + u_{2}^{k } + u_{0}^{k+1} ) \\
u_i^{k } ( 1 - 2\,r_x + C_2^{k }) + r_x (u_{1}^{k } + u_{3}^{k }  ) \\
\vdots \\
u_{n_x - 1}^{k } ( 1 - 2\,r_x + C_{n_x - 1}^{k }) + r_x (u_{n_x - 2}^{k } + u_{n_x}^{k }  ) \\
u_{n_x}^{k } ( 1 - 2\,r_x + C_i^{k }) + r_x (u_{n_x-1}^{k } + u_{n_x+1}^{k } + u_{n_x+1}^{k+1} ) 
\end{matrix}
\right).
\end{align*}

Since the matrix $B^n$ is tridiagonal this system of equations can be solved in $\mathcal{O}(n_x)$ operations.

\subsubsection{Three Dimensions}

In three dimensions the Crank-Nicolson scheme will not result in a tridiagonal system and the algorithm will become comparably slow. We therefore choose a two-step implicit alternating-direction scheme that still gives us linear time complexity in $n_x$ and $n_y$ and second order accuracy in $\Delta x$, $\Delta y$ and $\Delta z$ as well as unconditional stability~\cite{DissertationFuhse}. The algorithm consists of two steps in which the partial derivatives with respect to $x$ and $y$ are alternately evaluated either implicitly or explicitly. For each step equation \eqref{eq:paraxial_wave_equation} is approximated by a finite difference equation

\begin{align*}
\RN{1}. && \frac{u_{i,j}^{k+\frac{1}{2}} - u_{i,j}^{k}}{\Delta z/2} &=
A \left( \frac{\partial_x^2 u_{i,j}^{k+\frac{1}{2}}}{\Delta x^2}  + \frac{\partial_y^2 u_{i,j}^{k}}{\Delta y^2}  \right) + \frac{F_{i,j}^k u_{i,j}^{k} + F_{i,j}^{k+\frac{1}{2}} u_{i,j}^{k+\frac{1}{2}} }{2} \\
\RN{2}. && \frac{u_{i,j}^{k+1} - u_{i,j}^{k+\frac{1}{2}}}{\Delta z/2} &=
A \left(\frac{\partial_x^2 u_{i,j}^{k+\frac{1}{2}}}{\Delta x^2}  + \frac{\partial_y^2 u_{i,j}^{k+1}}{\Delta y^2}  \right) + \frac{F_{i,j}^{k+\frac{1}{2}} u_{i,j}^{k+\frac{1}{2}} + F_{i,j}^{k+1} u_{i,j}^{k+1} }{2} 
\end{align*}

{\centering 

where

}

\vspace{-1\baselineskip}

\begin{align*}
\partial_x^2 u_{i,j}^{k} := u_{i-1,j}^{k} - 2 u_{i,j}^{k} + u_{i+1,j}^{k}, && 
\partial_y^2 u_{i,j}^{k} := u_{i,j-1}^{k} - 2 u_{i,j}^{k} + u_{i,j+1}^{k},
\end{align*}

$F_{i,j}^{k} := F(x_i,y_j,z_k)$ and $z_{k+\frac{1}{2}} = \frac{z_{k} + z_{k+1}}{2}$. Similar as in the 2D case, reordering terms and introducing the auxiliary variables $r_x = \frac{A}{2} \frac{\Delta z}{ \Delta x^2}$, $\, r_y = \frac{A}{2} \frac{\Delta z}{ \Delta y^2}$ and $C_{i,j}^{k} = \frac{\Delta z}{4} F(x_i,y_j,z_{k})$ transforms step $\RN{1}.$ to

\begin{align} \label{eq:3D_finite_difference_equation}
( 1 - r_x \partial_x^2 - C_{i,j}^{k+\frac{1}{2}} ) u_{i}^{k+\frac{1}{2}} 
& = ( 1 + r_y \partial_y^2 + C_{i,j}^{k} ) u_{i}^{k}.
\end{align}

Taking into account the edge boundary conditions $u_{0,j}^k$, $u_{n_x+1,j}^{k}$,$u_{i,0}^k$, $u_{i,n_y+1}^{k}$ we obtain $n_y$ systems of linear equations

\begin{align} \label{eq:FD2DMatrixEquation}
B^n_j \boldsymbol u^{k+\frac{1}{2}}_j = \boldsymbol d^k_j,
\end{align}

where $\left(\boldsymbol u^{k}_j\right)_i = u_{i,j}^{k}$, $B^n$ is the $n_x \times n_x$ tridiagonal matrix

\begin{align*}
B^n = \left(
\begin{matrix}
    ( 1 + 2 \, r_x - C_1^{k+\frac{1}{2}} ) & - r_x & 0 &   \\
    - r_x  & ( 1 + 2 \, r_x - C_2^{k+\frac{1}{2}} ) & - r_x  & \dots \\
    0 & - r_x  & ( 1 + 2 \, r_x - C_3^{k+\frac{1}{2}} ) &  \\
     & \vdots & & \ddots
\end{matrix}
\right),
\end{align*}

and $d^k$ is a vector containing the right side of equation \eqref{eq:2D_finite_difference_equation} and the edge boundary conditions

\begin{align*}
\boldsymbol d^k_j = \left(
\begin{matrix}
( 1 + r_y \partial_y^2 + C_{1,j}^{k} ) \, u_{1,j}^{k} + r_x \, u_{0,j}^{k+\frac{1}{2}} \\
( 1 + r_y \partial_y^2 + C_{2,j}^{k} ) \, u_{2,j}^{k} \\
\vdots \\
( 1 + r_y \partial_y^2 + C_{n_x - 1,j}^{k} ) \, u_{n_x - 1,j}^{k} \\
( 1 + r_y \partial_y^2 + C_{n_x,j}^{k} ) \, u_{n_x,j}^{k} + r_x \, u_{n_x+1,j}^{k+\frac{1}{2}}
\end{matrix}
\right).
\end{align*}

Each of these $n_y$ tridiagonal systems can be solved in $\mathcal{O}(n_x)$ operations. For step $\RN{2}.$ we can deviate a similar group of $n_x$  tridiagonal systems of size $n_y \times n_y$ resulting in $\mathcal{O}(n_y \cdot n_x)$ total time complexity.





















